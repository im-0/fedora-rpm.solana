From 14d8003c18483a6fe25bc0e8873569de50eb45d9 Mon Sep 17 00:00:00 2001
From: Ivan Mironov <mironov.ivan@gmail.com>
Date: Thu, 18 Feb 2021 17:17:32 +0500
Subject: [PATCH 1/5] Replace bundled C/C++ libraries with system provided

---
 Cargo.lock                  | 11 +----------
 account-decoder/Cargo.toml  |  2 +-
 remote-wallet/Cargo.toml    |  2 +-
 runtime/Cargo.toml          |  2 +-
 storage-bigtable/Cargo.toml |  4 ++--
 5 files changed, 6 insertions(+), 15 deletions(-)

diff --git a/Cargo.lock b/Cargo.lock
index 3f849019645c..635100180046 100644
--- a/Cargo.lock
+++ b/Cargo.lock
@@ -3592,15 +3592,6 @@ version = "0.1.4"
 source = "registry+https://github.com/rust-lang/crates.io-index"
 checksum = "28988d872ab76095a6e6ac88d99b54fd267702734fd7ffe610ca27f533ddb95a"
 
-[[package]]
-name = "openssl-src"
-version = "300.1.6+3.1.4"
-source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "439fac53e092cd7442a3660c85dde4643ab3b5bd39040912388dcdabf6b88085"
-dependencies = [
- "cc",
-]
-
 [[package]]
 name = "openssl-sys"
 version = "0.9.99"
@@ -3609,7 +3600,6 @@ checksum = "22e1bf214306098e4832460f797824c05d25aacdf896f64a985fb0fd992454ae"
 dependencies = [
  "cc",
  "libc",
- "openssl-src",
  "pkg-config",
  "vcpkg",
 ]
@@ -9436,4 +9426,5 @@ checksum = "9fd07cbbc53846d9145dbffdf6dd09a7a0aa52be46741825f5c97bdd4f73f12b"
 dependencies = [
  "cc",
  "libc",
+ "pkg-config",
 ]
diff --git a/account-decoder/Cargo.toml b/account-decoder/Cargo.toml
index 7aee8478b4f1..20398a98b51b 100644
--- a/account-decoder/Cargo.toml
+++ b/account-decoder/Cargo.toml
@@ -26,7 +26,7 @@ spl-token-2022 = { workspace = true, features = ["no-entrypoint"] }
 spl-token-group-interface = { workspace = true }
 spl-token-metadata-interface = { workspace = true }
 thiserror = { workspace = true }
-zstd = { workspace = true }
+zstd = { workspace = true, features = ["pkg-config"] }
 
 [dev-dependencies]
 assert_matches = { workspace = true }
diff --git a/remote-wallet/Cargo.toml b/remote-wallet/Cargo.toml
index 8cea360d7c14..31afed7ee253 100644
--- a/remote-wallet/Cargo.toml
+++ b/remote-wallet/Cargo.toml
@@ -27,7 +27,7 @@ uriparse = { workspace = true }
 assert_matches = { workspace = true }
 
 [features]
-default = ["linux-static-hidraw", "hidapi"]
+default = ["linux-shared-hidraw", "hidapi"]
 linux-shared-hidraw = ["hidapi/linux-shared-hidraw"]
 linux-shared-libusb = ["hidapi/linux-shared-libusb"]
 linux-static-hidraw = ["hidapi/linux-static-hidraw"]
diff --git a/runtime/Cargo.toml b/runtime/Cargo.toml
index 355c85859789..b21922dc9237 100644
--- a/runtime/Cargo.toml
+++ b/runtime/Cargo.toml
@@ -77,7 +77,7 @@ symlink = { workspace = true }
 tar = { workspace = true }
 tempfile = { workspace = true }
 thiserror = { workspace = true }
-zstd = { workspace = true }
+zstd = { workspace = true, features = ["pkg-config"] }
 
 [lib]
 crate-type = ["lib"]
diff --git a/storage-bigtable/Cargo.toml b/storage-bigtable/Cargo.toml
index fafacf0292da..00c68836d9f9 100644
--- a/storage-bigtable/Cargo.toml
+++ b/storage-bigtable/Cargo.toml
@@ -34,13 +34,13 @@ solana-transaction-status = { workspace = true }
 thiserror = { workspace = true }
 tokio = { workspace = true }
 tonic = { workspace = true, features = ["tls", "transport"] }
-zstd = { workspace = true }
+zstd = { workspace = true, features = ["pkg-config"] }
 
 # openssl is a dependency of the goauth and smpl_jwt crates, but explicitly
 # declare it here as well to activate the "vendored" feature that builds OpenSSL
 # statically...
 [target."cfg(not(windows))".dependencies]
-openssl = { workspace = true, features = ["vendored"] }
+openssl = { workspace = true, features = [] }
 # ...except on Windows to avoid having to deal with getting CI past a build-time
 # Perl dependency
 [target."cfg(windows)".dependencies]
-- 
2.43.0


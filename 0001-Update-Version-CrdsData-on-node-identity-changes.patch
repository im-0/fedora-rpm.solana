From 0f60f414f4be9a9f11532e45f8a2a9c521137c26 Mon Sep 17 00:00:00 2001
From: Michael Vines <mvines@gmail.com>
Date: Thu, 24 Mar 2022 17:56:40 -0700
Subject: [PATCH] Update Version CrdsData on node identity changes

(cherry picked from commit 7ef18f220a3ed5193a535f8b60ee96b7efb7c27e)
---
 gossip/src/cluster_info.rs | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/gossip/src/cluster_info.rs b/gossip/src/cluster_info.rs
index 145753ecbe11..82480a4c522a 100644
--- a/gossip/src/cluster_info.rs
+++ b/gossip/src/cluster_info.rs
@@ -635,6 +635,10 @@ impl ClusterInfo {
         self.my_contact_info.write().unwrap().id = id;
 
         self.insert_self();
+        self.push_message(CrdsValue::new_signed(
+            CrdsData::Version(Version::new(self.id())),
+            &self.keypair(),
+        ));
         self.push_self(&HashMap::new(), None);
     }
 
-- 
2.36.1


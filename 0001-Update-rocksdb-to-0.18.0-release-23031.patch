From b97aa0f24fd15f2ce5465356a794cdda31390bb3 Mon Sep 17 00:00:00 2001
From: steviez <steven@solana.com>
Date: Wed, 9 Feb 2022 21:51:56 -0600
Subject: [PATCH] Update rocksdb to 0.18.0 release (#23031)

---
 Cargo.lock        | 21 +++++++++++++++++----
 ledger/Cargo.toml |  2 +-
 2 files changed, 18 insertions(+), 5 deletions(-)

diff --git a/Cargo.lock b/Cargo.lock
index e52d8df30f16..b63166ef080b 100644
--- a/Cargo.lock
+++ b/Cargo.lock
@@ -2390,14 +2390,16 @@ checksum = "c7d73b3f436185384286bd8098d17ec07c9a7d2388a6599f824d8502b529702a"
 
 [[package]]
 name = "librocksdb-sys"
-version = "6.20.3"
+version = "0.6.1+6.28.2"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "c309a9d2470844aceb9a4a098cf5286154d20596868b75a6b36357d2bb9ca25d"
+checksum = "81bc587013734dadb7cf23468e531aa120788b87243648be42e2d3a072186291"
 dependencies = [
  "bindgen",
+ "bzip2-sys",
  "cc",
  "glob",
  "libc",
+ "libz-sys",
 ]
 
 [[package]]
@@ -2467,6 +2469,17 @@ dependencies = [
  "libsecp256k1-core",
 ]
 
+[[package]]
+name = "libz-sys"
+version = "1.1.3"
+source = "registry+https://github.com/rust-lang/crates.io-index"
+checksum = "de5435b8549c16d423ed0c03dbaafe57cf6c3344744f1242520d59c9d8ecec66"
+dependencies = [
+ "cc",
+ "pkg-config",
+ "vcpkg",
+]
+
 [[package]]
 name = "linked-hash-map"
 version = "0.5.4"
@@ -3911,9 +3924,9 @@ dependencies = [
 
 [[package]]
 name = "rocksdb"
-version = "0.17.0"
+version = "0.18.0"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "7a62eca5cacf2c8261128631bed9f045598d40bfbe4b29f5163f0f802f8f44a7"
+checksum = "620f4129485ff1a7128d184bc687470c21c7951b64779ebc9cfdad3dcd920290"
 dependencies = [
  "libc",
  "librocksdb-sys",
diff --git a/ledger/Cargo.toml b/ledger/Cargo.toml
index 99e10e1be63d..f7fe09afb02d 100644
--- a/ledger/Cargo.toml
+++ b/ledger/Cargo.toml
@@ -57,7 +57,7 @@ reed-solomon-erasure = { version = "5.0.1", features = ["simd-accel"] }
 [dependencies.rocksdb]
 # Avoid the vendored bzip2 within rocksdb-sys that can cause linker conflicts
 # when also using the bzip2 crate
-version = "0.17.0"
+version = "0.18.0"
 default-features = false
 features = ["lz4"]
 
-- 
2.35.1

